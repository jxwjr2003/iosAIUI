# 实现 iOS UI 编辑器 - 任务清单

## 任务优先级
- **P0**：核心功能，必须完成
- **P1**：重要功能，建议完成  
- **P2**：优化功能，可选完成

## 任务列表

### P0 - 核心功能
- [ ] **实现基础项目结构和构建系统**
  - 创建项目目录结构（src/components, src/services, src/utils, src/styles）
  - 设置 HTML 入口文件，实现四区域布局（左侧35%、中间30%、右侧35%、底部AI聊天区域）
  - 配置 CSS 样式系统，支持响应式布局
  - 实现基础 JavaScript 模块加载系统

- [ ] **实现数据模型和状态管理**
  - 定义标准化的 JSON 数据格式（支持多根节点、层级 ID、属性类型）
  - 实现状态管理器（StateManager），支持观察者模式
  - 实现数据验证和清理功能，使用 AJV 进行 JSON Schema 验证
  - 实现修改日志系统，记录所有变更历史
  - 实现节点 ID 重新编号算法，确保层级编码连续性

- [ ] **实现 UI 树形编辑器**
  - 创建默认展开的树形组件（TreeNode），平铺展示所有节点及子节点
  - 每个节点右侧显示操作按钮组：添加子节点、删除节点、复制节点、粘贴子节点
  - 实现组件类型选择对话框，支持30+种iOS组件类型选择
  - 支持节点增删改查操作（添加、删除、重命名、移动）
  - 实现自动节点 ID 生成系统（030201 格式）
  - 支持多根节点管理和根节点切换
  - 实现节点拖拽排序功能
  - 添加节点搜索和过滤功能
  - 实现虚拟滚动，支持大型树形结构
  - 实现深度复制功能，包含节点及其所有子节点的完整层级结构
  - 实现粘贴功能，自动刷新节点ID和重新评估约束关系
  - 确保节点选择时属性编辑器实时同步显示节点信息

- [ ] **实现 iOS 模拟器**
  - 创建模拟器容器组件（Simulator）
  - 实现 CSS 基础的 iOS 风格渲染
  - 支持约束布局计算和实时预览
  - 实现根节点切换预览功能
  - 根节点宽度默认与模拟器内容区域宽度一致
  - 根节点高度自适应（约束包未提供高度时使用全屏高度）
  - 添加手动刷新按钮，根据当前选中的根节点重新渲染
  - 支持子节点修改时的根节点溯源展示
  - 添加缩放和重置视图功能
  - 支持约束包切换预览
  - 实现约束冲突检测和可视化
  - 实现设备尺寸选择功能，支持常见 iPhone 设备预设和自定义尺寸

- [ ] **实现属性编辑器**
  - 创建属性编辑面板（PropertyEditor）
  - 支持基础属性编辑（名称、类型、样式）
  - 实现约束包编辑器（支持尺寸、边界、中心、基线、宽高比约束）
  - 添加组件特定属性模板（为每个 UIKit 组件类型预定义常见属性）
  - 支持成员变量管理（String、Int、Bool、Double、Float、UIColor、UIFont 等）
  - 实现动作和函数配置界面
  - 添加协议配置支持
  - 实现属性类型验证和错误提示

- [ ] **实现数据管理功能**
  - 实现 JSON 导入功能（支持文件选择和拖拽）
  - 实现 JSON 导出功能（支持选择性展示根节点）
  - 实现 UI 层级转文本描述功能
  - 添加数据持久化（localStorage）
  - 支持版本兼容性检查和迁移
  - 实现数据格式严格验证

- [ ] **集成 AI 聊天助手**
  - 实现三栏布局的 AI 聊天界面（聊天历史55%、配置和上下文面板25%、修改日志面板20%）
  - 实现当前选中节点显示和传递机制
  - 通过 Electron 主进程连接 AI 服务器
  - 实现 JSON 规范描述系统（包含数据格式定义、字段说明和命令格式规范）
  - 支持 AI 配置管理（API Key、模型选择）
  - 实现命令逐一确认执行系统（支持逐一确认和批量确认）
  - 实现修改日志系统（记录、搜索、筛选、导出功能）
  - 实现 AI 命令安全验证和错误处理
  - 移除撤销重做功能，改为完整的修改日志记录

- [ ] **实现 Electron 主进程和 AI 服务**
  - 创建 Electron 主进程，处理应用生命周期和窗口管理
  - 实现 IPC 通信机制，支持渲染进程与主进程通信
  - 实现 AI 聊天 IPC 处理（ipcMain.handle('ai-chat', ...)）
  - 实现健康检查 IPC 处理（ipcMain.handle('health-check', ...)）
  - 实现 AI 配置管理 IPC 处理（ipcMain.handle('ai-config', ...)）
  - 实现模型发现 IPC 处理（ipcMain.handle('ai-models', ...)）
  - 实现连接测试 IPC 处理（ipcMain.handle('ai-test', ...)）
  - 集成 OpenAI Node.js SDK 或 HTTP 请求
  - 实现 API Key 安全存储（使用 Electron safeStorage）
  - 配置 electron-builder 打包系统，支持多平台打包

### P1 - 重要功能
- [ ] **优化性能和用户体验**
  - 实现虚拟滚动，支持大型树形结构
  - 添加加载状态和错误处理
  - 优化渲染性能，确保响应时间小于100ms
  - 添加键盘快捷键支持
  - 实现性能监控和警告机制

- [ ] **增强编辑功能**
  - 实现批量操作（批量删除、批量移动）
  - 添加复制粘贴功能
  - 实现节点模板和组件库
  - 添加约束可视化编辑
  - 实现约束冲突自动解决建议

- [ ] **完善 AI 功能**
  - 实现聊天历史记录
  - 添加预设提示词模板
  - 支持多轮对话上下文
  - 优化命令生成准确性
  - 实现 AI 修改历史记录和撤销

### P2 - 优化功能
- [ ] **高级功能**
  - 实现协作编辑功能
  - 添加版本历史对比
  - 支持自定义主题
  - 实现国际化支持

- [ ] **测试和质量保证**
  - 编写单元测试覆盖核心功能
  - 进行性能测试和优化
  - 添加端到端测试
  - 代码质量检查和重构

## 验收标准
- 所有 P0 任务完成并测试通过
- 支持复杂 UI 层级树（最多1000个节点）的流畅编辑
- 响应时间小于100ms
- JSON 导入导出功能正常工作
- AI 聊天助手能够正确生成和执行修改命令
- 模拟器能够正确渲染选中的根节点
- **属性编辑器支持所有定义的属性类型**

## 依赖关系
1. 基础项目结构 → 所有其他任务
2. 数据模型 → UI 树形编辑器、属性编辑器、模拟器
3. UI 树形编辑器 → 模拟器、属性编辑器
4. Electron 主进程和 AI 服务 → AI 聊天助手
5. AI 聊天助手 → 命令执行引擎
