# Project Context

## Purpose
创建一个iOS UI层级编辑器，通过可视化四区域界面构建、编辑和管理复杂的UI组件层级关系。该工具支持约束配置、实时预览，并能根据编辑后的树形结构输出指定的UI层级描述JSON数据。

**界面布局**：
- 左侧：树形结构编辑器（35%）
- 中间：iOS模拟器预览（30%）
- 右侧：属性编辑器（35%）
- 底部：AI聊天助手区域

**核心原则**：专注于UI层级结构的可视化编辑和标准化JSON输出，不涉及任何编程语言代码生成。

## Tech Stack
- **前端**: 原生JavaScript、CSS、HTML
- **桌面框架**: Electron (主进程 + 渲染进程)
- **数据格式**: JSON
- **渲染引擎**: 自定义CSS布局引擎
- **AI集成**: Node.js主进程直接连接第三方AI服务
- **构建工具**: Vite + electron-builder

## Project Conventions

### Code Style
- 使用ES6+ JavaScript语法
- CSS采用BEM命名规范
- HTML使用语义化标签
- 代码文件按功能模块组织

### Architecture Patterns
- 模块化设计，职责分离
- 观察者模式用于状态管理
- 命令模式支持撤销/重做
- 工厂模式创建UI组件
- 代理模式用于AI服务集成

### Testing Strategy
- 单元测试覆盖核心算法
- 集成测试验证组件交互
- 手动测试验证用户体验
- 性能测试确保响应时间要求

### Git Workflow
- 主分支保护策略
- 功能分支开发
- 提交信息遵循约定式提交规范

### Performance Standards
- 支持复杂UI层级树（最多1000个节点）
- 主要操作响应时间小于100ms
- 实时预览更新延迟小于50ms

### Security Standards
- Electron安全配置（禁用Node.js集成在渲染进程）
- API Key使用Electron安全存储
- 数据验证和输入清理
- 防止XSS和CSRF攻击
- 进程隔离和上下文隔离

### Code Quality Standards
- **单一文件限制**: 每个源代码文件不应超过600行代码，确保代码可维护性
- **类方法限制**: 每个类不应超过20个公共方法，避免功能过度集中
- **避免上帝类**: 严格避免创建承担过多职责的类，遵循单一职责原则
- **强制接口分离**: 确保类只实现它们真正需要的接口，减少耦合
- **模块化设计**: 将大型功能拆分为小型、可重用的模块
- **代码复用**: 鼓励代码复用，避免重复代码，提高开发效率
- **定期重构**: 在代码审查中识别并重构臃肿代码
- **复杂度监控**: 使用工具监控代码复杂度，及时预警

## Domain Context

### 核心概念
- **节点(Node)**: UI组件的基本单位，包含类型、属性、约束等
- **约束(Constraints)**: 定义组件间的布局关系，支持约束包系统
- **层级树(Tree)**: 描述UI组件的父子关系和嵌套结构，支持多根节点
- **模拟器(Simulator)**: 实时预览UI布局效果（基于CSS的Web模拟）
- **AI聊天助手**: 提供智能建议和JSON结构优化

### 功能模块
1. **树形编辑器**: 可视化编辑UI组件层级关系，支持增删改查、拖拽排序、多根节点管理
2. **iOS模拟器**: 实时渲染和预览UI效果，基于CSS转换实现iOS风格渲染
3. **属性编辑器**: 编辑组件属性、约束包、成员变量、动作、函数、协议配置
4. **数据管理**: JSON导入导出（支持选择性展示根节点），数据持久化和版本兼容性
5. **AI聊天助手**: 通过Electron主进程连接AI服务器，提供智能建议和命令执行

## Important Constraints
- 必须使用原生Web技术栈，不依赖任何前端框架
- 输出格式必须符合指定的UI层级描述规范
- 响应式设计，支持不同屏幕尺寸
- **性能要求**: 支持复杂UI层级树（最多1000个节点）的流畅编辑，响应时间小于100ms
- **安全要求**: Electron安全配置，API Key使用安全存储，实现数据验证和输入清理
- **进程通信**: 渲染进程与主进程通过IPC通信，避免跨域问题
- **AI集成**: Electron主进程通过代理架构连接第三方AI服务，支持完整的配置系统
- **专注原则**: 专注于JSON数据结构输出，不生成任何iOS/Swift代码

## External Dependencies
- **Electron**: 桌面应用框架
- **Node.js**: 运行时环境
- **浏览器API**: 使用现代浏览器支持的API
- **AI服务**: 通过Node.js主进程集成第三方AI服务（如OpenAI）
- **无第三方前端库**: 完全基于原生技术实现前端功能

## Implementation Details

### 数据模型
- 使用层级节点ID系统（030201格式）
- 支持多根节点树形结构
- 类型化的属性定义和验证
- 约束包系统支持完整的约束类型管理

### AI集成架构
- Electron主进程作为AI服务代理
- 支持前端配置API Key和模型选择
- 统一的IPC通信接口设计
- 命令执行引擎处理AI返回的修改命令

### 渲染引擎
- 使用CSS实现iOS风格渲染
- 将节点属性转换为CSS样式
- 使用Flexbox实现约束布局
- 仅用于静态Web预览，不处理用户交互
